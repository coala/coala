dependencies:
  cache_directories:
    - ~/.pyenv/versions/3.3.6
    - ~/.pyenv/versions/3.4.2
    - ~/.pyenv/versions/3.5.0b3
    - ~/.pyenv/versions/pypy3-2.4.0
  override:
    - sed -i '/source \/home\/ubuntu\/virtualenvs\//d' ~/.circlerc
    - bash .misc/deps.sh
    - python .misc/adjust_version_number.py coalib/VERSION -b $CIRCLE_BUILD_NUM
    - python ./coala --version

test:
  override:
    - bash .misc/tests.sh:
        parallel: true
    - python setup.py install:
        parallel: true
    - coala-ci:
        parallel: true
    - bash .misc/deploy.coverage.sh:
        parallel: true

deployment:
  deployment_scripts:
    branch: /.*/
    commands:
      - bash .misc/deploy.zanata.sh
      - bash .misc/deploy.pypi.sh
